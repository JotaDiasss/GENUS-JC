{% extends 'layout.html' %}
{% load static %}

{% block title %}Configurações de Conta - Jornal{% endblock %}

{% block extra_css %}
    <link rel="stylesheet" href="{% static 'styles/configuracoes.css' %}">
{% endblock %}

{% block content %}
<main class="main-content">
    <section class="content-section">
        <div class="section-header">
            <h2 class="section-title">Configurações de Conta</h2>
        </div>

        <div class="config-card profile-info" style="text-align: center; padding-bottom: 20px;">
            <h3 class="card-title">Informações do Usuário</h3>
            
            {% if request.GET.mode == 'foto' %}
                
                <form method="POST" action="{% url 'jornal:configuracoes_conta' %}" enctype="multipart/form-data" style="background: #f9f9f9; padding: 15px; border-radius: 8px; margin-top: 10px;">
                    {% csrf_token %}
                    <input type="hidden" name="tipo_form" value="foto">

                    {% if user.profile.foto %}
                        <div style="margin-bottom: 15px;">
                            <img src="{{ user.profile.foto.url }}" style="width: 100px; height: 100px; border-radius: 50%; object-fit: cover;">
                            <br>
                            <input type="checkbox" name="remover_foto" id="remover_foto_id">
                            <label for="remover_foto_id" style="color: red; font-size: 0.9em; cursor: pointer;">Remover foto atual</label>
                        </div>
                    {% else %}
                         <div style="margin-bottom: 15px;">
                            <img src="{% static 'assets/icons/Avatar.png' %}" style="width: 100px; height: 100px; border-radius: 50%; opacity: 0.5;">
                        </div>
                    {% endif %}

                    <div style="margin-bottom: 15px;">
                        <input type="file" name="foto" accept="image/*">
                    </div>

                    <button type="submit" class="save-button">Salvar Foto</button>
                    <a href="{% url 'jornal:configuracoes_conta' %}" style="color: #666; text-decoration: none; margin-left: 10px; font-size: 0.9em;">Cancelar</a>
                </form>

            {% else %}

                <div style="margin: 20px 0;">
                    {% if user.profile.foto %}
                        <img src="{{ user.profile.foto.url }}" alt="Foto de Perfil" style="width: 120px; height: 120px; border-radius: 50%; object-fit: cover; border: 3px solid #ddd;">
                    {% else %}
                        <img src="{% static 'assets/icons/Avatar.png' %}" alt="Sem Foto" style="width: 120px; height: 120px; border-radius: 50%; object-fit: cover; opacity: 0.6;">
                    {% endif %}
                </div>

                <p class="user-display">
                    Bem-vindo, <span class="username-highlight">{{ user.username }}</span>.
                </p>
                
                <a href="?mode=foto" class="edit-button" style="display: inline-block; margin-top: 10px; font-size: 0.9em;">Alterar Foto</a>

            {% endif %}
        </div>

        <div class="config-card genre-preferences-card">
            
            {% if request.GET.mode == 'generos' %}

                <form method="POST" action="{% url 'jornal:configuracoes_conta' %}">
                    {% csrf_token %}
                    <input type="hidden" name="tipo_form" value="generos">
                    
                    <h3 class="card-title">Gêneros Favoritos</h3>
                    <p class="preference-instructions">Selecione os gêneros de notícias que você mais gosta.</p>
                    
                    <div class="genre-container-config">
                        {% for genre in all_genres %}
                            <div class="genre-item-config">
                                <input type="checkbox" name="genres" class="genre-checkbox" value="{{ genre.nome }}" id="pref-{{ genre.id }}"
                                    {% if genre in generos_salvos %}checked{% endif %}>
                                <label for="pref-{{ genre.id }}">{{ genre.nome }}</label>
                            </div>
                        {% endfor %}
                    </div>
                    <button type="submit" class="save-button" id="save-prefs-button">Salvar Preferências</button>
                    <a href="{% url 'jornal:configuracoes_conta' %}" style="color: #666; text-decoration: none; margin-left: 10px; display: inline-block; margin-top: 15px;">Cancelar</a>
                </form>

            {% else %}

                <div class="preferences-header">
                    <h3 class="card-title">Seus Gêneros Favoritos</h3>
                    <a href="?mode=generos" class="edit-button">Alterar Preferências</a>
                </div>
                
                <div class="genre-container-display">
                    {% if generos_salvos %}
                        {% for genre in generos_salvos %}
                            <span class="genre-tag">{{ genre.nome }}</span>
                        {% endfor %}
                    {% else %}
                        <p style="color: #777; font-style: italic;">Nenhum gênero selecionado.</p>
                    {% endif %}
                </div>

            {% endif %}
        </div>
        
    </section>
</main>
{% endblock %}

{% block extra_scripts %}
    <script src="{% static 'scripts/configuracoes.js' %}"></script>
{% endblock %}